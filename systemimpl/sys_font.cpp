#include "../systemh/sys_font.h"
#include "../systemh/sys_vga13h_screen.h"

const uint8_t font_8x8_data[1024] = {
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 0-3
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 4-7
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 8-11
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 12-15
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 16-19
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 20-23
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 24-27
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, // 28-31
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // Space (32)
    0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00, // !
    0x24,0x24,0x24,0x00,0x00,0x00,0x00,0x00, // "
    0x24,0x24,0x7E,0x24,0x7E,0x24,0x24,0x00, // #
    0x08,0x3E,0x09,0x3E,0x20,0x3E,0x08,0x00, // $
    0x60,0x66,0x0C,0x18,0x30,0x66,0x06,0x00, // %
    0x38,0x6C,0x38,0x76,0x6C,0x6C,0x3A,0x00, // &
    0x18,0x18,0x08,0x00,0x00,0x00,0x00,0x00, // '
    0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00, // (
    0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00, // )
    0x00,0x18,0x7E,0x3C,0x7E,0x18,0x00,0x00, // *
    0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00, // +
    0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x08, // ,
    0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00, // -
    0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00, // .
    0x02,0x06,0x0C,0x18,0x30,0x60,0x40,0x00, // /
    0x3C,0x66,0x6E,0x7E,0x76,0x66,0x3C,0x00, // 0 (48)
    0x18,0x38,0x18,0x18,0x18,0x18,0x7E,0x00, // 1
    0x3C,0x66,0x06,0x0C,0x18,0x30,0x7E,0x00, // 2
    0x3C,0x66,0x06,0x1C,0x06,0x66,0x3C,0x00, // 3
    0x1C,0x3C,0x6C,0x6C,0x7E,0x0C,0x0C,0x00, // 4
    0x7E,0x60,0x7C,0x06,0x06,0x66,0x3C,0x00, // 5
    0x1C,0x30,0x60,0x7C,0x66,0x66,0x3C,0x00, // 6
    0x7E,0x06,0x0C,0x18,0x30,0x30,0x30,0x00, // 7
    0x3C,0x66,0x66,0x3C,0x66,0x66,0x3C,0x00, // 8
    0x3C,0x66,0x66,0x3E,0x06,0x0C,0x38,0x00, // 9 (57)
    0x00,0x18,0x18,0x00,0x18,0x18,0x00,0x00, // : (58)
    0x00,0x18,0x18,0x00,0x18,0x18,0x08,0x00, // ; (59)
    0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00, // < (60)
    0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00, // = (61)
    0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x00, // > (62)
    0x3C,0x66,0x06,0x0C,0x18,0x00,0x18,0x00, // ? (63)
    0x3C,0x66,0x6E,0x6E,0x60,0x66,0x3C,0x00, // @ (64)
    0x18,0x3C,0x66,0x66,0x7E,0x66,0x66,0x00, // A (65)
    0x7C,0x66,0x66,0x7C,0x66,0x66,0x7C,0x00, // B
    0x3C,0x66,0x60,0x60,0x60,0x66,0x3C,0x00, // C
    0x78,0x6C,0x66,0x66,0x66,0x6C,0x78,0x00, // D
    0x7E,0x60,0x60,0x78,0x60,0x60,0x7E,0x00, // E
    0x7E,0x60,0x60,0x78,0x60,0x60,0x60,0x00, // F
    0x3C,0x66,0x60,0x6E,0x66,0x66,0x3C,0x00, // G
    0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x00, // H
    0x3C,0x18,0x18,0x18,0x18,0x18,0x3C,0x00, // I
    0x1E,0x0C,0x0C,0x0C,0x0C,0x6C,0x38,0x00, // J
    0x66,0x6C,0x78,0x70,0x78,0x6C,0x66,0x00, // K
    0x60,0x60,0x60,0x60,0x60,0x60,0x7E,0x00, // L
    0x63,0x77,0x7F,0x6B,0x63,0x63,0x63,0x00, // M
    0x66,0x76,0x7E,0x7E,0x6E,0x66,0x66,0x00, // N
    0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00, // O
    0x7C,0x66,0x66,0x7C,0x60,0x60,0x60,0x00, // P
    0x3C,0x66,0x66,0x66,0x66,0x3C,0x0E,0x00, // Q
    0x7C,0x66,0x66,0x7C,0x78,0x6C,0x66,0x00, // R
    0x3C,0x66,0x60,0x3C,0x06,0x66,0x3C,0x00, // S
    0x7E,0x18,0x18,0x18,0x18,0x18,0x18,0x00, // T
    0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00, // U
    0x66,0x66,0x66,0x66,0x66,0x3C,0x18,0x00, // V
    0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00, // W
    0x66,0x66,0x3C,0x18,0x3C,0x66,0x66,0x00, // X
    0x66,0x66,0x66,0x3C,0x18,0x18,0x18,0x00, // Y
    0x7E,0x06,0x0C,0x18,0x30,0x60,0x7E,0x00, // Z (90)
    0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00, // [
    0x40,0x60,0x30,0x18,0x0C,0x06,0x02,0x00, // \ 
    0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00, // ]
    0x10,0x38,0x6C,0x00,0x00,0x00,0x00,0x00, // ^
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF, // _
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // 96-127 (small letters!!!)
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0
};

void FontEngine::draw_char(int x, int y, char c, uint8_t color) {
    if ((uint8_t)c >= 128) return;

    int font_index = (uint8_t)c * 8;

    for (int i = 0; i < 8; i++) {
        uint8_t line = font_8x8_data[font_index + i];
        for (int j = 0; j < 8; j++) {
            if (line & (0x80 >> j)) {
                put_pixel(x + j, y + i, color);
            }
        }
    }
}

void FontEngine::draw_string(int x, int y, const char* str, uint8_t color) {
    while (*str) {
        draw_char(x, y, *str, color);
        x += 8;
        str++;
    }
}